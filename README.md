# ergonomic-service-bindings
>Ergonomic Service Bindings for Cloudflare Workers: no more HTTP calls—directly call functions from your other workers

[Service Bindings](https://developers.cloudflare.com/workers/platform/bindings/about-service-bindings/) let your different Cloudflare workers talk to each other, _quickly_. However, it requires sending a mock HTTP request to the worker with which you're trying to communicate—which gives a lot of flexibility, but is sometimes more overhead than needed. This library simplifies that by letting you directly call functions on other Cloudflare workers.

## Concepts
- Each worker is either a _service_ worker, or a _consumer_ worker. 
- A _consumer_ worker can call functions from the _service_ workers it's bound to.
- A _service_ worker can only provide functions for _consumer_ workers to call

## Getting Started

### For _service_ workers

```shell
npm i ergonomic-service-bindings
```

Add the following section to your `wrangler.toml`:

```toml
[build]
command = "npm run build"
```

and change the `main` section to point to:

```toml
main = "esb/index.js"
```

Next, in your `package.json`, add a `"build"` script:

```json
    "build": "ergonomic-service-bindings service"
```

Finally, ensure you have a file called `src/service.ts`, which is where you'll be writing all your functions. Just export functions from here, and when you deploy your worker they'll be available to all services that bind your worker. For example, here's a hello world function:

```ts
export async function hello(name: string) {
  return `Hello ${name}`;
}
```

### For _consumer_ workers

```shell
npm i ergonomic-service-bindings
```

Add the following section to your `wrangler.toml`:

```toml
[build]
command = "npm run build"
```

and change the `main` section to point to:

```toml
main = "esb/index.js"
```

You'll also want to setup any service bindings to other workers you want to use. For instance, this binds to the worker called `test`:
```toml
services = [
  { binding = "test", service = "test", environment = "production"}
]
```

Next, in your `package.json`, add a `"build"` script:

```json
    "build": "ergonomic-service-bindings consumer"
```

And that's it! Here's an example of calling the function `hello` on a worker bound to `test`:

```ts
export default {
  async fetch(
    request: Request,
    env: Env,
    ctx: ExecutionContext
  ): Promise<Response> {
    return new Response(await env.test.hello('World'));
  }
};
```

### Typing

You don't need types for the functionality to work, but they definitely make the TS experience more pleasant. Simply define your env type within your _consumer_ worker as follows:

```ts
export interface Env {
  test: TestService;
}
```
where `TestService` is imported from the autogenerated file at the path `esb/service.types.ts` within your _service_ worker directory!
